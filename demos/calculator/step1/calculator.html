<html lang="en">
<head>
<title>Calculator</title>
<meta charset="utf-8"/>
</head>
<body>
<div id='test'></div>
<div id='test2'></div>

<div id="output"></div>
<button type='button' onclick='evaluateExpression()'></button>
<script src='../../../releases/parser.js'></script>
<script>
	//need optional...
	//comments
	//match until
	//Match except
/*	let grammar2 = `

EXPRESSION = OR[
  INTEGER_WITH_OPERATION_LIST,
  INTEGER
]

INTEGER_WITH_OPERATION_LIST = SEQUENCE[INTEGER, OPERATION_LIST]

OPERATION_LIST = MULTIPLE[
	OR[
		ADDITION_OPERATION,
		SUBTRACTION_OPERATION
	]
]

ADDITION_OPERATION = SEQUENCE['+', INTEGER]


SUBTRACTION_OPERATION = SEQUENCE['-', INTEGER]

INTEGER = CHARACTER_CLASS['0123456789']

`*/
	//Maybe OR should be renamed to MATCH_FIRST_OF
	//CHARACTER_CLASS['0123456789'] matches 100+3, but is this the best behaviour? Should it be called STARTS_WITH?
	//STARTS_WITH[MULTIPLE[CHARACTER_CLASS]]
	//ability to filter a tree by node type
let grammar = `

EXPRESSION = OR[
	INTEGER_WITH_OPERATION_LIST,
	INTEGER
]

INTEGER_WITH_OPERATION_LIST = SEQUENCE[INTEGER, OPERATION_LIST]

OPERATION_LIST = MULTIPLE[
	OR[
		ADDITION_OPERATION,
		SUBTRACTION_OPERATION
	]
]

ADDITION_OPERATION = SEQUENCE['+', INTEGER]


SUBTRACTION_OPERATION = SEQUENCE['-', INTEGER]

INTEGER = CHARACTER_CLASS['0123456789']

`
//WHITESPACE = MULTIPLE[' \n\t']

let parser = new Parser()
parser.setGrammar(grammar)

let input = ''


let output = parser.parse(input)


function evaluate(expressionTreeNode){
	let expressionValue
		switch(expressionTreeNode.name){
		case 'EXPRESSION':
			expressionValue = evaluate(expressionTreeNode.matches[0])

			return expressionValue
			break
		case 'INTEGER':
			return parseInt(expressionTreeNode.matchString, 10)
			break
		case 'INTEGER_WITH_OPERATION_LIST':
			expressionValue = Number(expressionTreeNode.matches[0].matchString)
			let operationList = expressionTreeNode.matches[1]

			for (let match of operationList.matches){
				if (match.name == 'ADDITION_OPERATION'){
					expressionValue += evaluate(match.matches[0])
				}else if (match.name == 'SUBTRACTION_OPERATION'){
					expressionValue -= evaluate(match.matches[0])
				}
			}
			return expressionValue
			break
	}
}
console.log(evaluate(output.root))

let treeViewer = new TreeViewer(output, document.querySelector('#test'))

treeViewer.display()

//let tree = new TreeNode(parser.runningGrammar, document.querySelector('#test2'))

</script>
</body>
</html>
